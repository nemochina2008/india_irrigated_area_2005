<document>
<category>milp</category>
<solver>CPLEX</solver>
<inputType>GAMS</inputType>
<client>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:54.0) Gecko/20100101 Firefox/54.0@144.173.225.124</client>
<priority>short</priority>
<email>sim.moulds@gmail.com</email>
<model><![CDATA[$TITLE Matrix adjustment program

*==============================================================================*
*                                                                              *
*           Except where otherwise noted, this work is licensed under          *
*               http://creativecommons.org/licenses/by-nc-sa/3.0/              *
*                                                                              *
*                                                                              *
*  You are free to share, to copy, distribute and transmit the work under      *
*  the following conditions:                                                   *
*                                                                              *
*  - Attribution:         You must attribute the work to: Andre Lemelin        *                            *
*  - Noncommercial:       You may not use this work for commercial purposes.   *
*  - Share Alike:         If you alter, transform, or build upon this work,    *
*                         you may distribute the resulting work only under     *
*                         the same or similar license to this one.             *
*                                                                              *
*==============================================================================*

* This program is based on the original GPCEMA program written by Andre
* Lemelin (2010). Other than changing the input data (and the corresponding
* sets, the program is the same). The original code is available at the
* following url: https://www.pep-net.org/pep-standard-cge-models.

* The program adjusts a matrix following the Junius and Oosterhaven (2003)
* principle, but with an objective function defined as the true Kullback-Leibler
* cross-entropy information-gain measure. The method is extended to deal with
* zero row-sums, or column-sums, or both.

* Reference:
* LEMELIN, Andre (2010), "A GRAS variant solving for minimum information loss",
* Economic Systems Research, 21(4), p. 399-408.

*==============================================================================*


SET I Row labels / CELL1, CELL2, CELL3, CELL4, CELL5, CELL6, CELL7, CELL8, CELL9, CELL10, CELL11, CELL12, CELL13, CELL14, CELL15, CELL16, CELL17, CELL18, CELL19, CELL20, CELL21, CELL22, CELL23, CELL24, CELL25, CELL26, CELL27, CELL28, CELL29, CELL30, CELL31, CELL32, CELL33, CELL34, CELL35, CELL36, CELL37, CELL38, CELL39, CELL40, CELL41, CELL42, CELL43, CELL44, CELL45, CELL46, CELL47, CELL48, CELL49, CELL50, CELL51, CELL52, CELL53, CELL54, CELL55, CELL56, CELL57, CELL58, CELL59, CELL60, CELL61, CELL62, CELL63, CELL64, CELL65, CELL66, CELL67, CELL68, CELL69, CELL70, CELL71, CELL72, CELL73, CELL74, CELL75, CELL76, CELL77, CELL78, CELL79, CELL80, CELL81, CELL82, CELL83, CELL84, CELL85, CELL86, CELL87, CELL88, CELL89, CELL90, CELL91, CELL92, CELL93, CELL94, CELL95, CELL96, CELL97, CELL98, CELL99, CELL100, CELL101, CELL102, CELL103, TOTAL_AR /;

SET I2(I) Row labels without CTOTS / CELL1, CELL2, CELL3, CELL4, CELL5, CELL6, CELL7, CELL8, CELL9, CELL10, CELL11, CELL12, CELL13, CELL14, CELL15, CELL16, CELL17, CELL18, CELL19, CELL20, CELL21, CELL22, CELL23, CELL24, CELL25, CELL26, CELL27, CELL28, CELL29, CELL30, CELL31, CELL32, CELL33, CELL34, CELL35, CELL36, CELL37, CELL38, CELL39, CELL40, CELL41, CELL42, CELL43, CELL44, CELL45, CELL46, CELL47, CELL48, CELL49, CELL50, CELL51, CELL52, CELL53, CELL54, CELL55, CELL56, CELL57, CELL58, CELL59, CELL60, CELL61, CELL62, CELL63, CELL64, CELL65, CELL66, CELL67, CELL68, CELL69, CELL70, CELL71, CELL72, CELL73, CELL74, CELL75, CELL76, CELL77, CELL78, CELL79, CELL80, CELL81, CELL82, CELL83, CELL84, CELL85, CELL86, CELL87, CELL88, CELL89, CELL90, CELL91, CELL92, CELL93, CELL94, CELL95, CELL96, CELL97, CELL98, CELL99, CELL100, CELL101, CELL102, CELL103 /;

SET J Column labels / CROP1, CROP2, CROP3, CROP4, CROP5, CROP6, CROP7, CROP8, CROP9, CROP10, CROP11, CROP12, CROP13, CROP14, CROP15, CROP16, CROP17, CROP18, CROP19, CROP20, CROP21, CROP22, CROP23, CROP24, CROP25, CROP26, CRPLND_AR, IRRI_AR /;
SET J2(J) Column labels without RTOTS / CROP1, CROP2, CROP3, CROP4, CROP5, CROP6, CROP7, CROP8, CROP9, CROP10, CROP11, CROP12, CROP13, CROP14, CROP15, CROP16, CROP17, CROP18, CROP19, CROP20, CROP21, CROP22, CROP23, CROP24, CROP25, CROP26 /;

SET J3(J2) Column labels of irrigated crops / CROP1, CROP3, CROP5, CROP7, CROP9, CROP11, CROP13, CROP15, CROP17, CROP19, CROP21, CROP23, CROP25 /;

ALIAS (I2,I2J);
ALIAS (J2,J2J);

TABLE
    DATA(I,J)
                    CROP1        CROP2        CROP3        CROP4        CROP5        CROP6        CROP7        CROP8        CROP9       CROP10       CROP11       CROP12       CROP13       CROP14       CROP15       CROP16       CROP17       CROP18       CROP19       CROP20       CROP21       CROP22       CROP23       CROP24       CROP25       CROP26    CRPLND_AR      IRRI_AR 
       CELL1            0            0            0            0            0            0            0            0            0            0            0       15.488            0            0            0            0            0            0            0            0            0            0            0            0            0            0      761.516      420.399 
       CELL2            0            0            0            0            0            0            0            0            0            0            0       13.507            0            0            0            0            0            0            0            0            0            0            0            0            0            0       26.338       14.567 
       CELL3            0            0            0            0            0            0            0            0            0            0            0       22.849            0            0       19.619            0            0            0            0            0            0            0            0            0            0            0      418.052      237.455 
       CELL4            0            0            0            0            0            0            0            0            0            0            0        4.051            0            0            0            0            0            0            0            0            0            0            0            0            0            0       680.01      375.879 
       CELL5            0            0            0            0            0            0            0            0            0            0            0       12.923            0            0            0            0            0            0            0            0            0            0            0            0            0            0     1490.118      877.315 
       CELL6            0            0            0            0            0            0            0            0            0            0            0       12.162            0            0            0            0            0            0            0            0            0            0            0            0            0            0      488.419      359.766 
       CELL7            0            0            0            0            0            0            0            0            0            0            0       16.394            0            0       14.558            0            0            0            0            0            0            0            0            0            0            0      475.551      199.132 
       CELL8            0            0            0            0            0            0            0            0            0            0            0       13.027            0            0            0            0            0            0            0            0            0            0            0            0            0            0      942.142      323.135 
       CELL9            0            0            0            0            0            0            0            0            0            0            0       22.115            0            0            0            0            0            0            0            0            0            0            0            0            0            0      1437.87      886.003 
      CELL10            0            0            0            0            0            0            0            0            0            0            0        8.588            0            0            0            0            0            0            0            0            0            0            0            0            0            0      795.745      820.372 
      CELL11            0            0            0            0            0            0            0            0            0            0            0        23.08            0            0       20.081            0            0            0            0            0            0            0            0            0            0            0     1810.871     1293.507 
      CELL12            0            0            0            0            0            0            0            0            0            0            0       14.655            0            0            0            0            0            0            0            0            0            0            0            0            0            0     1598.216     1389.607 
      CELL13            0            0            0            0            0            0            0            0            0            0            0       17.904            0            0       15.526            0            0            0            0            0            0            0            0            0            0            0      188.242      238.261 
      CELL14            0            0            0            0            0            0            0            0            0            0            0       30.336            0            0       26.038            0            0            0            0            0            0            0            0            0            0            0      4537.62     4205.516 
      CELL15            0            0            0            0            0            0            0            0            0            0            0       26.264            0            0       22.575            0            0            0            0            0            0            0            0            0            0            0     3490.744     3076.862 
      CELL16            0            0            0            0            0            0            0            0            0            0            0       17.611            0            0       15.319            0            0            0            0            0            0            0            0            0            0            0     1404.381     1413.758 
      CELL17            0            0            0            0            0            0            0            0            0            0            0       23.964            0            0            0            0            0            0            0            0            0            0            0            0            0            0     3313.914     3381.006 
      CELL18            0            0            0            0            0            0            0            0            0            0            0       15.597            0            0       13.843            0            0            0            0            0            0            0            0            0            0            0     1460.001      903.674 
      CELL19            0            0            0            0            0            0            0            0            0            0            0       16.113            0            0            0            0            0            0            0            0            0            0            0            0            0            0      186.071       16.025 
      CELL20            0            0            0            0            0            0            0            0            0            0            0        26.99            0            0            0            0            0            0            0            0            0            0            0            0            0            0       91.138       27.031 
      CELL21            0            0            0            0            0            0            0            0            0            0            0       25.975            0            0       22.509            0            0            0            0            0            0            0            0            0            0            0     1165.493      424.033 
      CELL22            0            0            0            0            0            0            0            0            0            0            0       32.657            0            0        28.05            0            0            0            0            0            0            0            0            0            0            0     3320.652     2667.944 
      CELL23            0            0            0            0            0            0            0            0            0            0            0       28.246            0            0       23.988            0            0            0            0            0            0            0            0            0            0            0     5847.583     5183.561 
      CELL24            0            0            0            0            0            0            0            0            0            0            0        22.19            0            0       18.869            0            0            0            0            0            0            0            0            0            0            0     5769.446     5220.334 
      CELL25            0            0            0            0            0            0            0            0            0            0            0       14.495            0            0       12.484            0            0            0            0            0            0            0            0            0            0            0     2782.982     2823.679 
      CELL26            0            0            0            0            0            0            0            0            0            0            0        26.98            0            0            0            0            0            0            0            0            0            0            0            0            0            0        604.9      646.291 
      CELL27            0            0            0            0            0            0            0            0            0            0            0       12.186            0            0       10.823            0            0            0            0            0            0            0            0            0            0            0      119.928      119.928 
      CELL28            0            0            0            0            0            0            0            0            0            0            0       29.716            0            0       25.585            0            0            0            0            0            0            0            0            0            0            0      286.733       15.602 
      CELL29            0            0            0            0            0            0            0            0            0            0            0       14.054            0            0            0            0            0            0            0            0            0            0            0            0            0            0      980.845      230.249 
      CELL30            0            0            0            0            0            0            0            0            0            0            0       25.563            0            0       21.937            0            0            0            0            0            0            0            0            0            0            0     3244.614     2542.667 
      CELL31            0            0            0            0            0            0            0            0            0            0            0       29.971            0            0       25.723            0            0            0            0            0            0            0            0            0            0            0     5947.312     4992.057 
      CELL32            0            0            0            0            0            0            0            0            0            0            0       34.544            0            0       29.675            0            0            0            0            0            0            0            0            0            0            0     6048.566     4872.997 
      CELL33            0            0            0            0            0            0            0            0            0            0            0       30.636            0            0       26.324            0            0            0            0            0            0            0            0            0            0            0     5811.065     4656.856 
      CELL34            0            0            0            0            0            0            0            0            0            0            0       28.749            0            0       24.462            0            0            0            0            0            0            0            0            0            0            0     2691.988     1485.622 
      CELL35            0            0            0            0            0            0            0            0            0            0            0       25.849            0            0       22.832            0            0            0            0            0            0            0            0            0            0            0      1019.84       69.224 
      CELL36            0            0            0            0            0            0            0            0            0            0            0       23.988            0            0            0            0            0            0            0            0            0            0            0            0            0            0     2936.781     2160.931 
      CELL37            0            0            0            0            0            0            0            0            0            0            0       27.361            0            0         23.5            0            0            0            0            0            0            0            0            0            0            0     5249.463     3192.371 
      CELL38            0            0            0            0            0            0            0            0            0            0            0       34.391            0            0       29.808            0            0            0            0            0            0            0            0            0            0            0     5279.397     2655.694 
      CELL39            0            0            0            0            0            0            0            0            0            0            0       38.507            0            0       33.385            0            0            0            0            0            0            0            0            0            0            0     5446.081     4050.511 
      CELL40            0            0            0            0            0            0            0            0            0            0            0       34.816            0            0       29.956            0            0            0            0            0            0            0            0            0            0            0     5893.968     5988.765 
      CELL41            0            0            0            0            0            0            0            0            0            0            0        36.02            0            0       31.004            0            0            0            0            0            0            0            0            0            0            0     1957.415     1369.716 
      CELL42            0            0            0            0            0            0            0            0            0            0            0       25.329            0            0            0            0            0            0            0            0            0            0            0            0            0            0      667.628      437.824 
      CELL43            0            0            0            0            0            0            0            0            0            0            0       31.019            0            0        27.42            0            0            0            0            0            0            0            0            0            0            0     3180.179      892.933 
      CELL44            0            0            0            0            0            0            0            0            0            0            0       37.617            0            0         32.6            0            0            0            0            0            0            0            0            0            0            0     5371.682     3300.018 
      CELL45            0            0            0            0            0            0            0            0            0            0            0       38.313            0            0       33.232            0            0            0            0            0            0            0            0            0            0            0     4828.125     3475.067 
      CELL46            0            0            0            0            0            0            0            0            0            0            0        37.27            0            0       32.077            0            0            0            0            0            0            0            0            0            0            0     5660.963      5762.12 
      CELL47            0            0            0            0            0            0            0            0            0            0            0       18.576            0            0           16            0            0            0            0            0            0            0            0            0            0            0     5862.825     5914.644 
      CELL48            0            0            0            0            0            0            0            0            0            0            0        39.52            0            0       33.689            0            0            0            0            0            0            0            0            0            0            0     3600.301     3705.881 
      CELL49            0            0            0            0            0            0            0            0            0            0            0       17.221            0            0       14.683            0            0            0            0            0            0            0            0            0            0            0      518.725      566.083 
      CELL50            0            0            0            0            0            0            0            0            0            0            0       26.701            0            0            0            0            0            0            0            0            0            0            0            0            0            0     1121.266      421.141 
      CELL51            0            0            0            0            0            0            0            0            0            0            0       28.365            0            0       25.055            0            0            0            0            0            0            0            0            0            0            0     5137.066     2610.629 
      CELL52            0            0            0            0            0            0            0            0            0            0            0       31.107            0            0            0            0            0            0            0            0            0            0            0            0            0            0     4695.983     3172.319 
      CELL53            0            0            0            0            0            0            0            0            0            0            0        42.19            0            0        35.93            0            0            0            0            0            0            0            0            0            0            0     5443.868     4822.811 
      CELL54            0            0            0            0            0            0            0            0            0            0            0       37.642            0            0       32.084            0            0            0            0            0            0            0            0            0            0            0     5882.811     5983.913 
      CELL55            0            0            0            0            0            0            0            0            0            0            0       39.343            0            0       33.596            0            0            0            0            0            0            0            0            0            0            0     4395.719     4012.735 
      CELL56            0            0            0            0            0            0            0            0            0            0            0       41.635            0            0       35.548            0            0            0            0            0            0            0            0            0            0            0     3639.859     3750.406 
      CELL57            0            0            0            0            0            0            0            0            0            0            0       15.001            0            0            0            0            0            0            0            0            0            0            0            0            0            0      150.516      150.516 
      CELL58            0            0            0            0            0            0            0            0            0            0            0       31.744            0            0            0            0            0            0            0            0            0            0            0            0            0            0     1748.314      127.617 
      CELL59            0            0            0            0            0            0            0            0            0            0            0       35.065            0            0            0            0            0            0            0            0            0            0            0            0            0            0     3006.906      1248.74 
      CELL60            0            0            0            0            0            0            0            0            0            0            0       34.521            0            0       29.396            0            0            0            0            0            0            0            0            0            0            0     5411.367     5504.429 
      CELL61            0            0            0            0            0            0            0            0            0            0            0       41.973            0            0       35.783            0            0            0            0            0            0            0            0            0            0            0     6562.043     6673.972 
      CELL62            0            0            0            0            0            0            0            0            0            0            0       47.477            0            0       41.019            0            0            0            0            0            0            0            0            0            0            0      387.464      487.177 
      CELL63            0            0            0            0            0            0            0            0            0            0            0         43.4            0            0            0            0            0            0            0            0            0            0            0            0            0            0        69.97       58.603 
      CELL64            0            0            0            0            0            0            0            0            0            0            0       43.478            0            0            0            0            0            0            0            0            0            0            0            0            0            0      111.373      112.083 
      CELL65            0            0            0            0            0            0            0            0            0            0            0        33.09            0            0       28.622            0            0            0            0            0            0            0            0            0            0            0      968.727      575.441 
      CELL66            0            0            0            0            0            0            0            0            0            0            0       48.412            0            0       41.294            0            0            0            0            0            0            0            0            0            0            0     4819.329      4192.89 
      CELL67            0            0            0            0            0            0            0            0            0            0            0       42.639            0            0       36.782            0            0            0            0            0            0            0            0            0            0            0     5324.797     4898.061 
      CELL68            0            0            0            0            0            0            0            0            0            0            0       48.543            0            0       41.936            0            0            0            0            0            0            0            0            0            0            0     2793.596     2693.674 
      CELL69            0            0            0            0            0            0            0            0            0            0            0        50.51            0            0            0            0            0            0            0            0            0            0            0            0            0            0      360.935      491.815 
      CELL70            0            0            0            0            0            0            0            0            0            0            0       49.109            0            0       42.828            0            0            0            0            0            0            0            0            0            0            0      388.518      518.473 
      CELL71            0            0            0            0            0            0            0            0            0            0            0       27.749            0            0       23.961            0            0            0            0            0            0            0            0            0            0            0      354.683      258.995 
      CELL72            0            0            0            0            0            0            0            0            0            0            0       37.823            0            0       32.288            0            0            0            0            0            0            0            0            0            0            0     5256.365     5357.947 
      CELL73            0            0            0            0            0            0            0            0            0            0            0       51.682            0            0       44.166            0            0            0            0            0            0            0            0            0            0            0     5369.057      5505.03 
      CELL74            0            0            0            0            0            0            0            0            0            0            0       53.017            0            0       45.316            0            0            0            0            0            0            0            0            0            0            0      5361.31     5500.429 
      CELL75            0            0            0            0            0            0            0            0            0            0            0       39.533            0            0       33.844            0            0            0            0            0            0            0            0            0            0            0       3696.7     3310.493 
      CELL76            0            0            0            0            0            0            0            0            0            0            0       45.395            0            0            0            0            0            0            0            0            0            0            0            0            0            0       126.85      229.975 
      CELL77            0            0            0            0            0            0            0            0            0            0            0       52.344            0            0       45.167            0            0            0            0            0            0            0            0            0            0            0      1658.89     1795.492 
      CELL78            0            0            0            0            0            0            0            0            0            0            0       44.115            0            0       37.654            0            0            0            0            0            0            0            0            0            0            0     3411.214     3526.876 
      CELL79            0            0            0            0            0            0            0            0            0            0            0       46.279            0            0       39.538            0            0            0            0            0            0            0            0            0            0            0     5718.696     5841.355 
      CELL80            0            0            0            0            0            0            0            0            0            0            0       55.076            0            0       47.135            0            0            0            0            0            0            0            0            0            0            0     5089.222     5232.504 
      CELL81            0            0            0            0            0            0            0            0            0            0            0       49.894            0            0       42.698            0            0            0            0            0            0            0            0            0            0            0     4224.763      3057.59 
      CELL82            0            0            0            0            0            0            0            0            0            0            0       46.639            0            0        39.96            0            0            0            0            0            0            0            0            0            0            0     4417.066      3947.16 
      CELL83            0            0            0            0            0            0            0            0            0            0            0       48.938            0            0       41.926            0            0            0            0            0            0            0            0            0            0            0     1834.409     1574.117 
      CELL84            0            0            0            0            0            0            0            0            0            0            0        25.46            0            0       22.191            0            0            0            0            0            0            0            0            0            0            0     1228.771      1299.19 
      CELL85            0            0            0            0            0            0            0            0            0            0            0       53.136            0            0       45.861            0            0            0            0            0            0            0            0            0            0            0     4387.003     3711.701 
      CELL86            0            0            0            0            0            0            0            0            0            0            0       49.888            0            0       42.638            0            0            0            0            0            0            0            0            0            0            0      5450.76     4537.531 
      CELL87            0            0            0            0            0            0            0            0            0            0            0       55.456            0            0       47.415            0            0            0            0            0            0            0            0            0            0            0     4418.965      4561.26 
      CELL88            0            0            0            0            0            0            0            0            0            0            0       54.923            0            0       47.031            0            0            0            0            0            0            0            0            0            0            0     3645.631     3786.859 
      CELL89            0            0            0            0            0            0            0            0            0            0            0       45.893            0            0       39.292            0            0            0            0            0            0            0            0            0            0            0      5829.83     5951.527 
      CELL90            0            0            0            0            0            0            0            0            0            0            0       53.575            0            0       45.364            0            0            0            0            0            0            0            0            0            0            0     5394.902     5533.815 
      CELL91            0            0            0            0            0            0            0            0            0            0            0       47.833            0            0       40.528            0            0            0            0            0            0            0            0            0            0            0      3460.99     1695.425 
      CELL92            0            0            0            0            0            0            0            0            0            0            0       49.135            0            0            0            0            0            0            0            0            0            0            0            0            0            0      205.176      205.951 
      CELL93            0            0            0            0            0            0            0            0            0            0            0       51.532            0            0       44.522            0            0            0            0            0            0            0            0            0            0            0     3797.395     3932.128 
      CELL94            0            0            0            0            0            0            0            0            0            0            0       51.473            0            0       44.024            0            0            0            0            0            0            0            0            0            0            0     4938.619     4696.029 
      CELL95            0            0            0            0            0            0            0            0            0            0            0       56.994            0            0            0            0            0            0            0            0            0            0            0            0            0            0     4520.381     2763.123 
      CELL96            0            0            0            0            0            0            0            0            0            0            0       51.025            0            0       43.689            0            0            0            0            0            0            0            0            0            0            0     1207.961     1166.505 
      CELL97            0            0            0            0            0            0            0            0            0            0            0       57.336            0            0       49.097            0            0            0            0            0            0            0            0            0            0            0     1100.772     1138.719 
      CELL98            0            0            0            0            0            0            0            0            0            0            0       57.296            0            0       49.079            0            0            0            0            0            0            0            0            0            0            0      4399.22     3433.609 
      CELL99            0            0            0            0            0            0            0            0            0            0            0       49.875            0            0       42.258            0            0            0            0            0            0            0            0            0            0            0     3096.388      510.174 
     CELL100            0            0            0            0            0            0            0            0            0            0            0       46.797            0            0       40.089            0            0            0            0            0            0            0            0            0            0            0     2407.616     2212.162 
     CELL101            0            0            0            0            0            0            0            0            0            0            0       55.838            0            0       47.883            0            0            0            0            0            0            0            0            0            0            0     2368.678     2319.451 
     CELL102            0            0            0            0            0            0            0            0            0            0            0       60.394            0            0       51.197            0            0            0            0            0            0            0            0            0            0            0      324.973      383.789 
     CELL103            0            0            0            0            0            0            0            0            0            0            0       59.335            0            0       50.316            0            0            0            0            0            0            0            0            0            0            0       61.582       62.452 
    TOTAL_AR            0            0            0            0            0            0            0            0            0            0            0         3619            0            0     2504.172            0            0            0            0            0            0            0            0            0            0            0 
;

*==============================================================================*
*------------------------------- List of parameters----------------------------*

PARAMETER
  OLDMAT(I,J)        A priori (non adjusted) distribution matrix
  NEWMAT(I,J)        Adjusted matrix
  ZSOL(I2,J2)        Solution values of ZED
  EPSILON            Lower bound on ZED to prevent log(0) and divisions by zero

*==============================================================================*
*-------------------------------- Variable names ------------------------------*

VARIABLE
  ZED(I2,J2)    Correction factors to be applied to the elements of OLDMAT
  OBJ           Objective function
;

* It is not sufficient to declare ZED as a positive variable. It must have a
* lower bound, defined below as EPSILON

*==============================================================================*
*------------------------------- Value assignments ----------------------------*

  OLDMAT(I,J) = DATA(I,J) ;

*  Display "INITIAL VALUES:", OLDMAT ;

  EPSILON=0.000001;

*==============================================================================*
*---------------------------------- Equations ---------------------------------*

EQUATIONS
  EQROW(I2)    Constraint on the adjusted row totals
  EQIRRROW(I2) Constraint on adjusted irrigated row totals
  EQCOL(J2)    Constraint on the adjusted column totals
  EQOBJ        Objective function
  ;

  EQROW(I2)..    SUM(J2,OLDMAT(I2,J2)*ZED(I2,J2))
                    =L= OLDMAT(I2,"CRPLND_AR") ;
                    
  EQIRRROW(I2).. SUM(J3,OLDMAT(I2,J3)*ZED(I2,J3))
                    =L= OLDMAT(I2,"IRRI_AR");
                    
  EQCOL(J2)..    SUM(I2,OLDMAT(I2,J2)*ZED(I2,J2))
                    =E= OLDMAT("TOTAL_AR",J2) ;

* The objective function is defined below:
* the specification minimizes cross-entropy (Kullback-Leibler measure),
* that is, information gain.

   EQOBJ..       OBJ =E=
                  SUM((I2,J2),ABS(OLDMAT(I2,J2))*ZED(I2,J2)*log(ZED(I2,J2)))
                  / SUM((I2,J2),ABS(OLDMAT(I2,J2))*ZED(I2,J2))
                  -log(SUM((I2,J2),ABS(OLDMAT(I2,J2))*ZED(I2,J2)))
                  +log(SUM((I2,J2),ABS(OLDMAT(I2,J2))));

*==============================================================================*
*---------------------------- Model definition --------------------------------*
MODEL ADJUS /ALL/;

*==============================================================================*
*------------------------- Initial value assignment ---------------------------*

* The lower bound assigned to ZED guarantees that there will be no log(0)
  ZED.LO(I2,J2) = EPSILON ;

* Initial value of ZED is set to the ratio of the sum of target marginal row
* totals to the sum of old matrix elements.
  ZED.L(I2,J2) = SUM(I2J,OLDMAT(I2J,"CRPLND_AR")) / SUM((I2J,J2J),OLDMAT(I2J,J2J));
  DISPLAY ZED.L ;

*==============================================================================*
*--------------------------Solution of the problem ----------------------------*

OPTION ITERLIM=100000;
* The following option limits to 5 the number of decimals
* in DISPLAY statement output only.
OPTION DECIMALS=5;
* It is preferable to use the solver CONOPT, which has a greater precision
* than MINOS5
OPTION NLP=CONOPT3;
SOLVE ADJUS USING NLP MINIMIZING OBJ;

*==============================================================================*
*                                  RESULTS
*---------------------- Calculation of adjusted matrix ------------------------*

  NEWMAT(I2,J2) = OLDMAT(I2,J2)*ZED.L(I2,J2) ;

* It is convenient to include row and column totals in NEWMAT
  NEWMAT("TOTAL_AR",J2) = SUM(I2,NEWMAT(I2,J2));
  NEWMAT(I2,"CRPLND_AR") = SUM(J2,NEWMAT(I2,J2));
  NEWMAT(I2,"IRRI_AR") = SUM(J3,NEWMAT(I2,J3));

  ZSOL(I2,J2)   = ZED.L(I2,J2) ;

  Acronym zero;
  NEWMAT(I,J)$(Not NEWMAT(I,J)) = zero;
  Display "&START NEW MATRIX";
  DISPLAY NEWMAT;
  DISPLAY "&END NEW MATRIX";
*  Display ZSOL;

]]></model>
<options><![CDATA[]]></options>
<gdx><![CDATA[]]></gdx>
<comments><![CDATA[]]></comments>
</document>
